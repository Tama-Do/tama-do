{"version":3,"sources":["ProjectSettings.js"],"names":["async","projectRoot","let","projectSettings","await","projectSettingsJsonFile","projectSettingsFile","readAsync","e","writeAsync","projectSettingsDefaults","hostType","_","defaults","json","mergeAsync","cantReadFileDefault","setAsync","packagerInfoFile","readPackagerInfoAsync","setPackagerInfoAsync","getPackagerOptsAsync","dotExpoProjectDirectory","dotExpoProjectDirectoryExists","lanType","dev","strict","minify","urlType","urlRandomness","filename","path","join","dirPath","oldDirPath","fs","statSync","isDirectory","renameSync","mkdirp","sync"],"mappings":"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","file":"../ProjectSettings.js","sourcesContent":["/**\n * @flow\n */\n\nimport 'instapromise';\n\nimport _ from 'lodash';\nimport JsonFile from '@exponent/json-file';\nimport fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\n\nlet projectSettingsFile = 'settings.json';\nlet projectSettingsDefaults = {\n  hostType: 'tunnel',\n  lanType: 'ip',\n  dev: true,\n  strict: false,\n  minify: false,\n  urlType: 'exp',\n  urlRandomness: null,\n};\nlet packagerInfoFile = 'packager-info.json';\n\nfunction projectSettingsJsonFile(projectRoot: string, filename: string) {\n  return new JsonFile(\n    path.join(dotExpoProjectDirectory(projectRoot), filename)\n  );\n}\n\nexport async function readAsync(projectRoot: string) {\n  let projectSettings;\n  try {\n    projectSettings = await projectSettingsJsonFile(\n      projectRoot,\n      projectSettingsFile\n    ).readAsync();\n  } catch (e) {\n    projectSettings = await projectSettingsJsonFile(\n      projectRoot,\n      projectSettingsFile\n    ).writeAsync(projectSettingsDefaults);\n  }\n\n  if (projectSettings.hostType === 'ngrok') {\n    // 'ngrok' is deprecated\n    projectSettings.hostType = 'tunnel';\n  }\n\n  // Set defaults for any missing fields\n  _.defaults(projectSettings, projectSettingsDefaults);\n  return projectSettings;\n}\n\nexport async function setAsync(projectRoot: string, json: any) {\n  try {\n    return await projectSettingsJsonFile(\n      projectRoot,\n      projectSettingsFile\n    ).mergeAsync(json, { cantReadFileDefault: projectSettingsDefaults });\n  } catch (e) {\n    return await projectSettingsJsonFile(\n      projectRoot,\n      projectSettingsFile\n    ).writeAsync(_.defaults(json, projectSettingsDefaults));\n  }\n}\n\nexport async function readPackagerInfoAsync(projectRoot: string) {\n  try {\n    return await projectSettingsJsonFile(\n      projectRoot,\n      packagerInfoFile\n    ).readAsync({ cantReadFileDefault: {} });\n  } catch (e) {\n    return await projectSettingsJsonFile(\n      projectRoot,\n      packagerInfoFile\n    ).writeAsync({});\n  }\n}\n\nexport async function setPackagerInfoAsync(projectRoot: string, json: any) {\n  try {\n    return await projectSettingsJsonFile(\n      projectRoot,\n      packagerInfoFile\n    ).mergeAsync(json, { cantReadFileDefault: {} });\n  } catch (e) {\n    return await projectSettingsJsonFile(\n      projectRoot,\n      packagerInfoFile\n    ).writeAsync(json);\n  }\n}\n\nexport function dotExpoProjectDirectory(projectRoot: string) {\n  let dirPath = path.join(projectRoot, '.expo');\n  try {\n    // move .exponent to .expo\n    let oldDirPath = path.join(projectRoot, '.exponent');\n    if (fs.statSync(oldDirPath).isDirectory()) {\n      fs.renameSync(oldDirPath, dirPath);\n    }\n  } catch (e) {\n    // no old directory, continue\n  }\n\n  mkdirp.sync(dirPath);\n  return dirPath;\n}\n\nexport function dotExpoProjectDirectoryExists(projectRoot: string) {\n  let dirPath = path.join(projectRoot, '.expo');\n  try {\n    if (fs.statSync(dirPath).isDirectory()) {\n      return true;\n    }\n  } catch (e) {\n    // file doesn't exist\n  }\n\n  return false;\n}\n\nexport async function getPackagerOptsAsync(projectRoot: string) {\n  let projectSettings = await readAsync(projectRoot);\n  return projectSettings;\n}\n"],"sourceRoot":"/xdl/src"}