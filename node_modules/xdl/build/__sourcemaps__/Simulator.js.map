{"version":3,"sources":["Simulator.js"],"names":["async","args","await","spawnAsync","e","_isLicenseOutOfDate","stdout","stderr","ErrorCode","XCODE_LICENSE_NOT_ACCEPTED","Logger","global","error","join","_xcrunAsync","let","result","osascript","execAsync","trim","console","XCODE_NOT_INSTALLED_ERROR","warn","matches","match","length","version","semver","valid","lt","SUGGESTED_XCODE_VERSION","isXDLError","toString","_isSimulatorInstalledAsync","_isSimulatorRunningAsync","info","_waitForSimulatorRunningAsync","_openSimulatorAsync","zeroMeansNo","bootedDevice","_bootedSimulatorDeviceAsync","delayAsync","infoJson","JSON","parse","_listSimulatorDevicesAsync","simulatorDeviceInfo","runtime","devices","i","device","state","_quitSimulatorAsync","simDir","_dirForSimulatorDevice","udid","glob","promise","cwd","_isExpoAppInstalledOnCurrentBootedSimulatorAsync","_waitForExpoAppInstalledOnCurrentBootedSimulatorAsync","regex","regexMatch","exec","_expoVersionOnCurrentBootedSimulatorAsync","versions","Api","versionsAsync","installedVersion","iosVersion","notifications","code","NotificationCode","OLD_IOS_APP_VERSION","_checkExpoUpToDateAsync","url","dir","path","_simulatorCacheDirectory","downloadAsync","extract","existsAsync","filesInDir","fs","readdir","rimraf","sync","mkdirp","iosUrl","_downloadSimulatorAppAsync","START_LOADING","STOP_LOADING","_installExpoOnSimulatorAsync","message","includes","_uninstallExpoAppFromSimulatorAsync","_lastUrl","upgradeExpoAsync","_openUrlInSimulatorAsync","isDetached","success","msg","Analytics","logEvent","platform","openUrlInSimulatorSafeAsync","projectRoot","projectUrl","UrlUtils","constructManifestUrlAsync","hostType","exp","ProjectUtils","readConfigJsonAsync","openProjectAsync","isPlatformSupported","process","text","lower","toLowerCase","resolve","homeDir","dotExpoHomeDirectory","UserSettings"],"mappings":";;;;;;;;+BA+CAA,WAA2BC,IAA3BD,EAAiC;AAC/B,QAAI;AACF,aAAOE,MAAMC,iDAAW,OAAXA,EAAoBF,IAApBE,CAAb;AACF,KAFA,CAEE,OAAOC,CAAP,EAAU;AACV,UAAIC,oBAAoBD,EAAEE,MAAtBD,KAAiCA,oBAAoBD,EAAEG,MAAtBF,CAArC,EAAoE;AAClE,cAAM,4CACJG,0CAAUC,0BADN,EAEJ,uEAFI,CAAN;AAIF,OALA,MAKO;AACLC,4CAAOC,MAAPD,CAAcE,KAAdF,CACG,yBAAwBT,KAAKY,IAALZ,CAAU,GAAVA,CAAe,OAAMG,EAAEG,MAAO,EADzDG;AAGA,cAAMN,CAAN;AACF;AACF;AACF,G;;kBAhBeU,W;;;;;AAkBf;;;;gCACOd,aAA4C;AACjDe,QAAIC,MAAJD;AACA,QAAI;AACFC,eAAS,CAACd,MAAMe,0CAAUC,SAAVD,CAAoB,uBAApBA,CAAP,EAAqDE,IAArD,EAATH;AACF,KAFA,CAEE,OAAOZ,CAAP,EAAU;AACVgB,cAAQR,KAARQ,CACE,iGADFA,EAEEhB,CAFFgB;AAIAV,0CAAOC,MAAPD,CAAcE,KAAdF,CAAoBW,yBAApBX;AACA,aAAO,KAAP;AACF;AACA,QAAIM,WAAW,2BAAf,EAA4C;AAC1CI,cAAQE,IAARF,CACE,kDACEJ,MADF,GAEE,6BAHJI;AAKAV,0CAAOC,MAAPD,CAAcE,KAAdF,CAAoBW,yBAApBX;AACA,aAAO,KAAP;AACF;;AAEA;AACA,QAAI;AACF,YAAM,EAAEJ,MAAF,KAAaJ,MAAMC,iDAAW,YAAXA,EAAyB,CAAC,UAAD,CAAzBA,CAAzB;;AAEA;AACAY,UAAIQ,UAAUjB,OAAOkB,KAAPlB,CAAa,sBAAbA,CAAdS;AACA,UAAIQ,QAAQE,MAARF,KAAmB,CAAvB,EAA0B;AACxB;AACAH,gBAAQR,KAARQ,CAAc,qDAAdA;AACAV,4CAAOC,MAAPD,CAAcE,KAAdF,CACE,0FADFA;AAGA,eAAO,KAAP;AACF;;AAEA;AACA,YAAMgB,UAAUH,QAAQ,CAARA,IAAa,IAA7B;;AAEA,UAAI,CAACI,oCAAOC,KAAPD,CAAaD,OAAbC,CAAL,EAA4B;AAC1BP,gBAAQR,KAARQ,CAAc,mCAAmCG,QAAQ,CAARA,CAAjDH;AACA,eAAO,KAAP;AACF;;AAEA,UAAIO,oCAAOE,EAAPF,CAAUD,OAAVC,EAAmBG,uBAAnBH,CAAJ,EAAiD;AAC/CP,gBAAQE,IAARF,CACG,eAAcM,OAAQ,+CAA8CI,uBAAwB,GAD/FV;AAGF;AACF,KA3BA,CA2BE,OAAOhB,CAAP,EAAU;AACV;AACAgB,cAAQR,KAARQ,CAAe,kCAAiChB,CAAE,EAAlDgB;AACAV,0CAAOC,MAAPD,CAAcE,KAAdF,CAAoBW,yBAApBX;AACA,aAAO,KAAP;AACF;;AAEA;AACA,QAAI;AACFR,YAAMY,YAAY,CAAC,QAAD,EAAW,MAAX,CAAZA,CAANZ;AACF,KAFA,CAEE,OAAOE,CAAP,EAAU;AACV,UAAIA,EAAE2B,UAAN,EAAkB;AAChBrB,4CAAOC,MAAPD,CAAcE,KAAdF,CAAoBN,EAAE4B,QAAF5B,EAApBM;AACF,OAFA,MAEO;AACLU,gBAAQE,IAARF,CAAc,yBAAwBhB,EAAE4B,QAAF5B,EAAa,EAAnDgB;AACAV,4CAAOC,MAAPD,CAAcE,KAAdF,CACE,wGADFA;AAGF;AACA,aAAO,KAAP;AACF;;AAEA,WAAO,IAAP;AACF,G;;kBAzEsBuB,0B;;;;;AA2EtB;;;;gCACOjC,aAAqC;AAC1C,QAAI,EAACE,MAAMgC,0BAAP,CAAJ,EAAuC;AACrCxB,0CAAOC,MAAPD,CAAcyB,IAAdzB,CAAmB,uBAAnBA;AACAR,YAAMC,iDAAW,MAAXA,EAAmB,CAAC,IAAD,EAAO,WAAP,CAAnBA,CAAND;AACAA,YAAMkC,+BAANlC;AACF;AACF,G;;kBANsBmC,mB;;;;;;gCAQfrC,aAA0C;AAC/Ce,QAAIuB,cAAc,CAACpC,MAAMe,0CAAUC,SAAVD,CACvB,uEADuBA,CAAP,EAEfE,IAFe,EAAlBJ;AAGA,QAAIuB,gBAAgB,GAApB,EAAyB;AACvB,aAAO,KAAP;AACF;;AAEAvB,QAAIwB,eAAerC,MAAMsC,6BAAzBzB;AACA,WAAO,CAAC,CAACwB,YAAT;AACF,G;;kBAVsBL,wB;;;;;;gCAYtBlC,aAA+C;AAC7C,QAAIE,MAAMgC,0BAAV,EAAsC;AACpC,aAAO,IAAP;AACF,KAFA,MAEO;AACLhC,YAAMuC,iDAAW,GAAXA,CAANvC;AACA,aAAOA,MAAMkC,+BAAb;AACF;AACF,G;;kBAPeA,6B;;;;;;gCASfpC,aAA4C;AAC1Ce,QAAI2B,WAAWxC,MAAMY,YAAY,CAAC,QAAD,EAAW,MAAX,EAAmB,SAAnB,EAA8B,QAA9B,CAAZA,CAArBC;AACAA,QAAIoB,OAAOQ,KAAKC,KAALD,CAAWD,SAASpC,MAApBqC,CAAX5B;AACA,WAAOoB,IAAP;AACF,G;;kBAJeU,0B;;;;;;gCAMf7C,aAA6C;AAC3Ce,QAAI+B,sBAAsB5C,MAAM2C,4BAAhC9B;AACA,SAAKA,IAAIgC,OAAT,IAAoBD,oBAAoBE,OAAxC,EAAiD;AAC/CjC,UAAIiC,UAAUF,oBAAoBE,OAApBF,CAA4BC,OAA5BD,CAAd/B;AACA,WAAKA,IAAIkC,IAAI,CAAb,EAAgBA,IAAID,QAAQvB,MAA5B,EAAoCwB,GAApC,EAAyC;AACvClC,YAAImC,SAASF,QAAQC,CAARD,CAAbjC;AACA,YAAImC,OAAOC,KAAPD,KAAiB,QAArB,EAA+B;AAC7B,iBAAOA,MAAP;AACF;AACF;AACF;AACA,WAAO,IAAP;AACF,G;;kBAZeV,2B;;;;;;gCAsBRxC,aAAqC;AAC1C,WAAOE,MAAMe,0CAAUC,SAAVD,CAAoB,sCAApBA,CAAb;AACF,G;;kBAFsBmC,mB;;;;;AAItB;;;;gCACOpD,aAAkE;AACvEe,QAAImC,SAAShD,MAAMsC,6BAAnBzB;AACA,QAAI,CAACmC,MAAL,EAAa;AACX,aAAO,KAAP;AACF;AACAnC,QAAIsC,SAASnD,MAAMoD,uBAAuBJ,OAAOK,IAA9BD,CAAnBvC;AACAA,QAAIQ,UAAUrB,MAAMsD,gCAAKC,OAALD,CAClB,iFADkBA,EAElB,EAAEE,KAAKL,MAAP,EAFkBG,CAApBzC;;AAKA,WAAOQ,QAAQE,MAARF,GAAiB,CAAxB;AACF,G;;kBAZsBoC,gD;;;;;;iCAcf3D,aAAuE;AAC5E,QAAIE,MAAMyD,kDAAV,EAA8D;AAC5D,aAAO,IAAP;AACF,KAFA,MAEO;AACLzD,YAAMuC,iDAAW,GAAXA,CAANvC;AACA,aAAOA,MAAM0D,uDAAb;AACF;AACF,G;;kBAPsBA,qD;;;;;;iCASf5D,aAA2D;AAChEe,QAAImC,SAAShD,MAAMsC,6BAAnBzB;AACA,QAAI,CAACmC,MAAL,EAAa;AACX,aAAO,IAAP;AACF;AACAnC,QAAIsC,SAASnD,MAAMoD,uBAAuBJ,OAAOK,IAA9BD,CAAnBvC;AACAA,QAAIQ,UAAUrB,MAAMsD,gCAAKC,OAALD,CAClB,uDADkBA,EAElB,EAAEE,KAAKL,MAAP,EAFkBG,CAApBzC;;AAKA,QAAIQ,QAAQE,MAARF,KAAmB,CAAvB,EAA0B;AACxB,aAAO,IAAP;AACF;;AAEAR,QAAI8C,QAAQ,2BAAZ9C;AACAA,QAAI+C,aAAaD,MAAME,IAANF,CAAWtC,QAAQ,CAARA,CAAXsC,CAAjB9C;AACA,QAAI+C,WAAWrC,MAAXqC,GAAoB,CAAxB,EAA2B;AACzB,aAAO,IAAP;AACF;;AAEA,WAAOA,WAAW,CAAXA,CAAP;AACF,G;;kBAtBsBE,yC;;;;;;iCAwBfhE,aAAyC;AAC9Ce,QAAIkD,WAAW/D,MAAMgE,8BAAIC,aAAJD,EAArBnD;AACAA,QAAIqD,mBAAmBlE,MAAM8D,2CAA7BjD;;AAEA,QAAI,CAACqD,gBAAD,IAAqBzC,oCAAOE,EAAPF,CAAUyC,gBAAVzC,EAA4BsC,SAASI,UAArC1C,CAAzB,EAA2E;AACzEjB,0CAAO4D,aAAP5D,CAAqBY,IAArBZ,CACE,EAAE6D,MAAMC,wDAAiBC,mBAAzB,EADF/D,EAEE,0FAFFA;AAIF;AACF,G;;kBAVsBgE,uB;;;;;;iCAYf1E,WAA0C2E,GAA1C3E,EAA+C;AACpD;AACA,QAAI2E,GAAJ,EAAS;AACP5D,UAAI6D,MAAMC,cAAKhE,IAALgE,CAAUC,0BAAVD,EAAuC,kBAAvCA,CAAV9D;AACAb,YAAMgE,8BAAIa,aAAJb,CAAkBS,GAAlBT,EAAuBU,GAAvBV,EAA4B,EAAEc,SAAS,IAAX,EAA5Bd,CAANhE;AACA,aAAO0E,GAAP;AACF;;AAEA7D,QAAIkD,WAAW/D,MAAMgE,8BAAIC,aAAJD,EAArBnD;AACAA,QAAI6D,MAAMC,cAAKhE,IAALgE,CACRC,0BADQD,EAEP,YAAWZ,SAASI,UAAW,MAFxBQ,CAAV9D;;AAKA,QAAIb,MAAM+E,mDAAYL,GAAZK,CAAV,EAA4B;AAC1BlE,UAAImE,aAAahF,MAAMiF,YAAG1B,OAAH0B,CAAWC,OAAXD,CAAmBP,GAAnBO,CAAvBpE;AACA,UAAImE,WAAWzD,MAAXyD,GAAoB,CAAxB,EAA2B;AACzB,eAAON,GAAP;AACF,OAFA,MAEO;AACLS,4CAAOC,IAAPD,CAAYT,GAAZS;AACF;AACF;;AAEAE,wCAAOD,IAAPC,CAAYX,GAAZW;AACA,QAAI;AACFrF,YAAMgE,8BAAIa,aAAJb,CAAkBD,SAASuB,MAA3BtB,EAAmCU,GAAnCV,EAAwC,EAAEc,SAAS,IAAX,EAAxCd,CAANhE;AACF,KAFA,CAEE,OAAOE,CAAP,EAAU;AACViF,0CAAOC,IAAPD,CAAYT,GAAZS;AACA,YAAMjF,CAAN;AACF;;AAEA,WAAOwE,GAAP;AACF,G;;kBAhCsBa,0B;;;;;AAkCtB;;;;iCACOzF,WAA4C2E,GAA5C3E,EAAiD;AACtDU,wCAAOC,MAAPD,CAAcyB,IAAdzB,CAAoB,oCAApBA;AACAA,wCAAO4D,aAAP5D,CAAqByB,IAArBzB,CAA0B,EAAE6D,MAAMC,wDAAiBkB,aAAzB,EAA1BhF;AACAK,QAAI6D,MAAM1E,MAAMuF,2BAA2Bd,GAA3Bc,CAAhB1E;AACAL,wCAAOC,MAAPD,CAAcyB,IAAdzB,CAAmB,kCAAnBA;AACAK,QAAIC,SAASd,MAAMY,YAAY,CAAC,QAAD,EAAW,SAAX,EAAsB,QAAtB,EAAgC8D,GAAhC,CAAZ9D,CAAnBC;AACAL,wCAAO4D,aAAP5D,CAAqByB,IAArBzB,CAA0B,EAAE6D,MAAMC,wDAAiBmB,YAAzB,EAA1BjF;AACA,WAAOM,MAAP;AACF,G;;kBARsB4E,4B;;;;;;iCAUf5F,aAAqD;AAC1D,QAAI;AACFU,0CAAOC,MAAPD,CAAcyB,IAAdzB,CAAmB,uCAAnBA;AACAR,YAAMY,YAAY,CAAC,QAAD,EAAW,WAAX,EAAwB,QAAxB,EAAkC,mBAAlC,CAAZA,CAANZ;AACF,KAHA,CAGE,OAAOE,CAAP,EAAU;AACV,UAAIA,EAAEyF,OAAFzF,IAAaA,EAAEyF,OAAFzF,CAAU0F,QAAV1F,CAAmB,wBAAnBA,CAAjB,EAA+D;AAC7D,eAAO,IAAP;AACF,OAFA,MAEO;AACLgB,gBAAQR,KAARQ,CAAchB,CAAdgB;AACA,cAAMhB,CAAN;AACF;AACF;AACF,G;;kBAZsB2F,mC;;;;;;iCAqBf/F,aAAkC;AACvC,QAAI,EAACE,MAAM+B,4BAAP,CAAJ,EAAyC;AACvC;AACF;;AAEA/B,UAAMmC,qBAANnC;;AAEAA,UAAM6F,qCAAN7F;AACAA,UAAM0F,8BAAN1F;;AAEA,QAAI8F,QAAJ,EAAc;AACZtF,0CAAOC,MAAPD,CAAcyB,IAAdzB,CAAoB,WAAUsF,QAAS,WAAvCtF;AACAR,YAAMY,YAAY,CAAC,QAAD,EAAW,SAAX,EAAsB,QAAtB,EAAgCkF,QAAhC,CAAZlF,CAANZ;AACA8F,iBAAW,IAAXA;AACF;AACF,G;;kBAfsBC,gB;;;;;AAiBtB;;;;iCACOjG,WAAwC2E,GAAxC3E,EAAqD;AAC1D,WAAOE,MAAMY,YAAY,CAAC,QAAD,EAAW,SAAX,EAAsB,QAAtB,EAAgC6D,GAAhC,CAAZ7D,CAAb;AACF,G;;kBAFsBoF,wB;;;;;;iCAIflG,WACL2E,GADK3E,EAELmG,aAAsB,KAFjBnG,EAGL;AACA,QAAI,EAACE,MAAM+B,4BAAP,CAAJ,EAAyC;AACvC,aAAO;AACLmE,iBAAS,KADJ;AAELC,aAAK;AAFA,OAAP;AAIF;;AAEA,QAAI;AACFnG,YAAMmC,qBAANnC;;AAEA,UACE,CAACiG,UAAD,IAAe,EAACjG,MAAMyD,kDAAP,CADjB,EAEE;AACAzD,cAAM0F,8BAAN1F;AACAA,cAAM0D,uDAAN1D;AACF;;AAEA,UAAI,CAACiG,UAAL,EAAiB;AACfH,mBAAWrB,GAAXqB;AACAtB,kCAFe,CAEU;AAC3B;;AAEAhE,0CAAOC,MAAPD,CAAcyB,IAAdzB,CAAoB,WAAUiE,GAAI,mBAAlCjE;AACAR,YAAMgG,yBAAyBvB,GAAzBuB,CAANhG;AACF,KAjBA,CAiBE,OAAOE,CAAP,EAAU;AACV,UAAIA,EAAE2B,UAAN,EAAkB;AAChB;AACA;AACArB,4CAAOC,MAAPD,CAAcE,KAAdF,CAAoBN,EAAEyF,OAAtBnF;AACA,eAAO;AACL0F,mBAAS,KADJ;AAELC,eAAM,GAAEjG,EAAE4B,QAAF5B,EAAa;AAFhB,SAAP;AAIF;;AAEA,UAAI+F,UAAJ,EAAgB;AACdzF,4CAAOC,MAAPD,CAAcE,KAAdF,CACG,sHAAqHN,EAAE4B,QAAF5B,EAAa,EADrIM;AAGF,OAJA,MAIO;AACLA,4CAAOC,MAAPD,CAAcE,KAAdF,CAAqB,oCAAmCN,EAAE4B,QAAF5B,EAAa,EAArEM;AACF;;AAEA,aAAO;AACL0F,iBAAS,KADJ;AAELC,aAAM,GAAEjG,EAAE4B,QAAF5B,EAAa;AAFhB,OAAP;AAIF;;AAEAkG,sCAAUC,QAAVD,CAAmB,oBAAnBA,EAAyC;AACvCE,gBAAU;AAD6B,KAAzCF;;AAIA,WAAO;AACLF,eAAS;AADJ,KAAP;AAGF,G;;kBA5DsBK,2B;;;;;;iCA8DfzG,WAAgC0G,WAAhC1G,EAAqD;AAC1De,QAAI4F,aAAazG,MAAM0G,gCAASC,yBAATD,CAAmCF,WAAnCE,EAAgD;AACrEE,gBAAU;AAD2D,KAAhDF,CAAvB7F;;AAIAA,QAAI,EAAEgG,GAAF,KAAU7G,MAAM8G,wCAAaC,mBAAbD,CAAiCN,WAAjCM,CAApBjG;;AAEAb,UAAMuG,4BAA4BE,UAA5BF,EAAwC,CAAC,CAACM,IAAIZ,UAA9CM,CAANvG;AACF,G;;kBARsBgH,gB;;;;;QA3XNC,mB,GAAAA,mB;QA6JA7D,sB,GAAAA,sB;QAmIAwB,wB,GAAAA,wB;;AA9ThB;;;;AAEA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;AACA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;AACA;;;;AAEA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;;;;;AAEA/D,IAAIiF,WAAW,IAAfjF;;AAEA,MAAMe,0BAA2B,OAAjC;AACA,MAAMT,4BACJ,uQADF;;AAGO,SAAS8F,mBAAT,GAA+B;AACpC,SAAOC,QAAQZ,QAARY,KAAqB,QAA5B;AACF;;AAEA,SAAS/G,mBAAT,CAA6BgH,IAA7B,EAAmC;AACjC,MAAI,CAACA,IAAL,EAAW;AACT,WAAO,KAAP;AACF;;AAEAtG,MAAIuG,QAAQD,KAAKE,WAALF,EAAZtG;AACA,SAAOuG,MAAMxB,QAANwB,CAAe,OAAfA,KAA2BA,MAAMxB,QAANwB,CAAe,SAAfA,CAAlC;AACF;;AAkJO,SAAShE,sBAAT,CAAgCC,IAAhC,EAA8C;AACnD,SAAOsB,cAAK2C,OAAL3C,CACL4C,4CADK5C,EAEL,yCAFKA,EAGLtB,IAHKsB,CAAP;AAKF;;AA6HO,SAASC,wBAAT,GAAoC;AACzC/D,MAAI2G,uBAAuBC,gDAAaD,oBAAbC,EAA3B5G;AACAA,MAAI6D,MAAMC,cAAKhE,IAALgE,CAAU6C,oBAAV7C,EAAgC,yBAAhCA,CAAV9D;AACAwE,sCAAOD,IAAPC,CAAYX,GAAZW;AACA,SAAOX,GAAP;AACF","file":"../Simulator.js","sourcesContent":["/**\n * @flow\n */\n\nimport 'instapromise';\n\nimport delayAsync from 'delay-async';\nimport existsAsync from 'exists-async';\nimport glob from 'glob';\nimport homeDir from 'home-dir';\nimport mkdirp from 'mkdirp';\nimport osascript from '@exponent/osascript';\nimport path from 'path';\nimport semver from 'semver';\nimport spawnAsync from '@exponent/spawn-async';\nimport rimraf from 'rimraf';\nimport fs from 'fs';\n\nimport * as Analytics from './Analytics';\nimport Api from './Api';\nimport ErrorCode from './ErrorCode';\nimport Logger from './Logger';\nimport NotificationCode from './NotificationCode';\nimport * as ProjectUtils from './project/ProjectUtils';\nimport UserSettings from './UserSettings';\nimport XDLError from './XDLError';\nimport * as UrlUtils from './UrlUtils';\n\nlet _lastUrl = null;\n\nconst SUGGESTED_XCODE_VERSION = `8.2.0`;\nconst XCODE_NOT_INSTALLED_ERROR =\n  'Simulator not installed. Please visit https://developer.apple.com/xcode/download/ to download Xcode and the iOS simulator. If you already have the latest version of Xcode installed, you may have to run the command `sudo xcode-select -s /Applications/Xcode.app`.';\n\nexport function isPlatformSupported() {\n  return process.platform === 'darwin';\n}\n\nfunction _isLicenseOutOfDate(text) {\n  if (!text) {\n    return false;\n  }\n\n  let lower = text.toLowerCase();\n  return lower.includes('xcode') && lower.includes('license');\n}\n\nasync function _xcrunAsync(args) {\n  try {\n    return await spawnAsync('xcrun', args);\n  } catch (e) {\n    if (_isLicenseOutOfDate(e.stdout) || _isLicenseOutOfDate(e.stderr)) {\n      throw new XDLError(\n        ErrorCode.XCODE_LICENSE_NOT_ACCEPTED,\n        'Xcode license is not accepted. Please run `sudo xcodebuild -license`.'\n      );\n    } else {\n      Logger.global.error(\n        `Error running \\`xcrun ${args.join(' ')}\\`: ${e.stderr}`\n      );\n      throw e;\n    }\n  }\n}\n\n// Simulator installed\nexport async function _isSimulatorInstalledAsync() {\n  let result;\n  try {\n    result = (await osascript.execAsync('id of app \"Simulator\"')).trim();\n  } catch (e) {\n    console.error(\n      \"Can't determine id of Simulator app; the Simulator is most likely not installed on this machine\",\n      e\n    );\n    Logger.global.error(XCODE_NOT_INSTALLED_ERROR);\n    return false;\n  }\n  if (result !== 'com.apple.iphonesimulator') {\n    console.warn(\n      \"Simulator is installed but is identified as '\" +\n        result +\n        \"'; don't know what that is.\"\n    );\n    Logger.global.error(XCODE_NOT_INSTALLED_ERROR);\n    return false;\n  }\n\n  // check xcode version\n  try {\n    const { stdout } = await spawnAsync('xcodebuild', ['-version']);\n\n    // find something that looks like a dot separated version number\n    let matches = stdout.match(/[\\d]{1,2}\\.[\\d]{1,3}/);\n    if (matches.length === 0) {\n      // very unlikely\n      console.error('No version number found from `xcodebuild -version`.');\n      Logger.global.error(\n        'Unable to check Xcode version. Command ran successfully but no version number was found.'\n      );\n      return false;\n    }\n\n    // we're cheating to use the semver lib, but it expects a proper patch version which xcode doesn't have\n    const version = matches[0] + '.0';\n\n    if (!semver.valid(version)) {\n      console.error('Invalid version number found: ' + matches[0]);\n      return false;\n    }\n\n    if (semver.lt(version, SUGGESTED_XCODE_VERSION)) {\n      console.warn(\n        `Found Xcode ${version}, which is older than the recommended Xcode ${SUGGESTED_XCODE_VERSION}.`\n      );\n    }\n  } catch (e) {\n    // how would this happen? presumably if Simulator id is found then xcodebuild is installed\n    console.error(`Unable to check Xcode version: ${e}`);\n    Logger.global.error(XCODE_NOT_INSTALLED_ERROR);\n    return false;\n  }\n\n  // make sure we can run simctl\n  try {\n    await _xcrunAsync(['simctl', 'help']);\n  } catch (e) {\n    if (e.isXDLError) {\n      Logger.global.error(e.toString());\n    } else {\n      console.warn(`Unable to run simctl: ${e.toString()}`);\n      Logger.global.error(\n        'xcrun may not be configured correctly. Try running `sudo xcode-select --reset` and running this again.'\n      );\n    }\n    return false;\n  }\n\n  return true;\n}\n\n// Simulator opened\nexport async function _openSimulatorAsync() {\n  if (!await _isSimulatorRunningAsync()) {\n    Logger.global.info('Opening iOS simulator');\n    await spawnAsync('open', ['-a', 'Simulator']);\n    await _waitForSimulatorRunningAsync();\n  }\n}\n\nexport async function _isSimulatorRunningAsync() {\n  let zeroMeansNo = (await osascript.execAsync(\n    'tell app \"System Events\" to count processes whose name is \"Simulator\"'\n  )).trim();\n  if (zeroMeansNo === '0') {\n    return false;\n  }\n\n  let bootedDevice = await _bootedSimulatorDeviceAsync();\n  return !!bootedDevice;\n}\n\nasync function _waitForSimulatorRunningAsync() {\n  if (await _isSimulatorRunningAsync()) {\n    return true;\n  } else {\n    await delayAsync(100);\n    return await _waitForSimulatorRunningAsync();\n  }\n}\n\nasync function _listSimulatorDevicesAsync() {\n  let infoJson = await _xcrunAsync(['simctl', 'list', 'devices', '--json']);\n  let info = JSON.parse(infoJson.stdout);\n  return info;\n}\n\nasync function _bootedSimulatorDeviceAsync() {\n  let simulatorDeviceInfo = await _listSimulatorDevicesAsync();\n  for (let runtime in simulatorDeviceInfo.devices) {\n    let devices = simulatorDeviceInfo.devices[runtime];\n    for (let i = 0; i < devices.length; i++) {\n      let device = devices[i];\n      if (device.state === 'Booted') {\n        return device;\n      }\n    }\n  }\n  return null;\n}\n\nexport function _dirForSimulatorDevice(udid: string) {\n  return path.resolve(\n    homeDir(),\n    'Library/Developer/CoreSimulator/Devices',\n    udid\n  );\n}\n\nexport async function _quitSimulatorAsync() {\n  return await osascript.execAsync('tell application \"Simulator\" to quit');\n}\n\n// Expo installed\nexport async function _isExpoAppInstalledOnCurrentBootedSimulatorAsync() {\n  let device = await _bootedSimulatorDeviceAsync();\n  if (!device) {\n    return false;\n  }\n  let simDir = await _dirForSimulatorDevice(device.udid);\n  let matches = await glob.promise(\n    './data/Containers/Data/Application/*/Library/Caches/Snapshots/host.exp.Exponent',\n    { cwd: simDir }\n  );\n\n  return matches.length > 0;\n}\n\nexport async function _waitForExpoAppInstalledOnCurrentBootedSimulatorAsync() {\n  if (await _isExpoAppInstalledOnCurrentBootedSimulatorAsync()) {\n    return true;\n  } else {\n    await delayAsync(100);\n    return await _waitForExpoAppInstalledOnCurrentBootedSimulatorAsync();\n  }\n}\n\nexport async function _expoVersionOnCurrentBootedSimulatorAsync() {\n  let device = await _bootedSimulatorDeviceAsync();\n  if (!device) {\n    return null;\n  }\n  let simDir = await _dirForSimulatorDevice(device.udid);\n  let matches = await glob.promise(\n    './data/Containers/Bundle/Application/*/Exponent-*.app',\n    { cwd: simDir }\n  );\n\n  if (matches.length === 0) {\n    return null;\n  }\n\n  let regex = /Exponent\\-([0-9\\.]+)\\.app/;\n  let regexMatch = regex.exec(matches[0]);\n  if (regexMatch.length < 2) {\n    return null;\n  }\n\n  return regexMatch[1];\n}\n\nexport async function _checkExpoUpToDateAsync() {\n  let versions = await Api.versionsAsync();\n  let installedVersion = await _expoVersionOnCurrentBootedSimulatorAsync();\n\n  if (!installedVersion || semver.lt(installedVersion, versions.iosVersion)) {\n    Logger.notifications.warn(\n      { code: NotificationCode.OLD_IOS_APP_VERSION },\n      'This version of the Expo app is out of date. Uninstall the app and run again to upgrade.'\n    );\n  }\n}\n\nexport async function _downloadSimulatorAppAsync(url) {\n  // If specific URL given just always download it and don't use cache\n  if (url) {\n    let dir = path.join(_simulatorCacheDirectory(), `Exponent-tmp.app`);\n    await Api.downloadAsync(url, dir, { extract: true });\n    return dir;\n  }\n\n  let versions = await Api.versionsAsync();\n  let dir = path.join(\n    _simulatorCacheDirectory(),\n    `Exponent-${versions.iosVersion}.app`\n  );\n\n  if (await existsAsync(dir)) {\n    let filesInDir = await fs.promise.readdir(dir);\n    if (filesInDir.length > 0) {\n      return dir;\n    } else {\n      rimraf.sync(dir);\n    }\n  }\n\n  mkdirp.sync(dir);\n  try {\n    await Api.downloadAsync(versions.iosUrl, dir, { extract: true });\n  } catch (e) {\n    rimraf.sync(dir);\n    throw e;\n  }\n\n  return dir;\n}\n\n// url: Optional URL of Exponent.app tarball to download\nexport async function _installExpoOnSimulatorAsync(url) {\n  Logger.global.info(`Downloading latest version of Expo`);\n  Logger.notifications.info({ code: NotificationCode.START_LOADING });\n  let dir = await _downloadSimulatorAppAsync(url);\n  Logger.global.info('Installing Expo on iOS simulator');\n  let result = await _xcrunAsync(['simctl', 'install', 'booted', dir]);\n  Logger.notifications.info({ code: NotificationCode.STOP_LOADING });\n  return result;\n}\n\nexport async function _uninstallExpoAppFromSimulatorAsync() {\n  try {\n    Logger.global.info('Uninstalling Expo from iOS simulator.');\n    await _xcrunAsync(['simctl', 'uninstall', 'booted', 'host.exp.Exponent']);\n  } catch (e) {\n    if (e.message && e.message.includes('No devices are booted.')) {\n      return null;\n    } else {\n      console.error(e);\n      throw e;\n    }\n  }\n}\n\nexport function _simulatorCacheDirectory() {\n  let dotExpoHomeDirectory = UserSettings.dotExpoHomeDirectory();\n  let dir = path.join(dotExpoHomeDirectory, 'ios-simulator-app-cache');\n  mkdirp.sync(dir);\n  return dir;\n}\n\nexport async function upgradeExpoAsync() {\n  if (!await _isSimulatorInstalledAsync()) {\n    return;\n  }\n\n  await _openSimulatorAsync();\n\n  await _uninstallExpoAppFromSimulatorAsync();\n  await _installExpoOnSimulatorAsync();\n\n  if (_lastUrl) {\n    Logger.global.info(`Opening ${_lastUrl} in Expo.`);\n    await _xcrunAsync(['simctl', 'openurl', 'booted', _lastUrl]);\n    _lastUrl = null;\n  }\n}\n\n// Open Url\nexport async function _openUrlInSimulatorAsync(url: string) {\n  return await _xcrunAsync(['simctl', 'openurl', 'booted', url]);\n}\n\nexport async function openUrlInSimulatorSafeAsync(\n  url: string,\n  isDetached: boolean = false\n) {\n  if (!await _isSimulatorInstalledAsync()) {\n    return {\n      success: false,\n      msg: 'Unable to verify Xcode and Simulator installation.',\n    };\n  }\n\n  try {\n    await _openSimulatorAsync();\n\n    if (\n      !isDetached && !await _isExpoAppInstalledOnCurrentBootedSimulatorAsync()\n    ) {\n      await _installExpoOnSimulatorAsync();\n      await _waitForExpoAppInstalledOnCurrentBootedSimulatorAsync();\n    }\n\n    if (!isDetached) {\n      _lastUrl = url;\n      _checkExpoUpToDateAsync(); // let this run in background\n    }\n\n    Logger.global.info(`Opening ${url} in iOS simulator`);\n    await _openUrlInSimulatorAsync(url);\n  } catch (e) {\n    if (e.isXDLError) {\n      // Hit some internal error, don't try again.\n      // This includes Xcode license errors\n      Logger.global.error(e.message);\n      return {\n        success: false,\n        msg: `${e.toString()}`,\n      };\n    }\n\n    if (isDetached) {\n      Logger.global.error(\n        `Error running app. Have you installed the app already using Xcode? Since you are detached you must build manually. ${e.toString()}`\n      );\n    } else {\n      Logger.global.error(`Error installing or running app. ${e.toString()}`);\n    }\n\n    return {\n      success: false,\n      msg: `${e.toString()}`,\n    };\n  }\n\n  Analytics.logEvent('Open Url on Device', {\n    platform: 'ios',\n  });\n\n  return {\n    success: true,\n  };\n}\n\nexport async function openProjectAsync(projectRoot: string) {\n  let projectUrl = await UrlUtils.constructManifestUrlAsync(projectRoot, {\n    hostType: 'localhost',\n  });\n\n  let { exp } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n\n  await openUrlInSimulatorSafeAsync(projectUrl, !!exp.isDetached);\n}\n"],"sourceRoot":"/xdl/src"}